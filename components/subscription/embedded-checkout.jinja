{#
  Embedded Checkout Component
  
  A modal/drawer that loads the Eshtarek checkout flow.
  Triggered after plan selection on the product page.
  
  Supports two modes:
  1. iframe mode - loads checkout URL in an iframe
  2. redirect mode - redirects to external checkout page
#}

{# Checkout Modal #}
<dialog
  id="eshtarek-checkout-dialog"
  class="backdrop:bg-black/50 m-0 h-full w-full max-w-none bg-transparent p-0 md:m-auto md:h-auto md:max-h-[90vh] md:max-w-lg md:rounded-xl"
  data-eshtarek-checkout
>
  <div class="bg-background flex h-full flex-col md:h-auto md:max-h-[90vh] md:rounded-xl md:shadow-xl">
    {# Header #}
    <div class="border-border-light flex items-center justify-between border-b px-4 py-3">
      <h2 class="text-foreground text-base font-semibold">{{ _('Complete Your Subscription') }}</h2>
      <button
        type="button"
        class="text-muted-foreground hover:text-foreground rounded-full p-1 transition-colors"
        data-checkout-close
        aria-label="{{ _('Close') }}"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    {# Checkout Content #}
    <div class="flex-1 overflow-auto">
      {# Loading State #}
      <div data-checkout-loading class="flex items-center justify-center p-12">
        <div class="text-center">
          <svg class="mx-auto mb-3 size-8 animate-spin text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 1 1-6.219-8.56" />
          </svg>
          <p class="text-muted-foreground text-sm">{{ _('Processing...') }}</p>
        </div>
      </div>

      {# Iframe Container (for embedded checkout) #}
      <div data-checkout-iframe-container class="hidden h-full">
        <iframe
          data-checkout-iframe
          class="h-full min-h-[500px] w-full border-0"
          title="{{ _('Complete Your Subscription') }}"
          allow="payment"
        ></iframe>
      </div>

      {# Success State #}
      <div data-checkout-success class="hidden p-8 text-center">
        <div class="mx-auto mb-4 flex size-16 items-center justify-center rounded-full bg-green-100">
          <svg class="size-8 text-green-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <h3 class="text-foreground mb-2 text-lg font-semibold">{{ _('Subscription Created!') }}</h3>
        <p class="text-muted-foreground mb-6 text-sm">{{ _('You can manage your subscription from your account.') }}</p>
        <div class="flex flex-col gap-2">
          <a
            href="{{ settings.eshtarek_portal_url|default('https://portal.eshtarek.com', true) }}"
            class="btn btn-filled btn-lg w-full"
            data-checkout-manage-link
          >
            {{ _('Manage Subscription') }}
          </a>
          <button
            type="button"
            class="btn btn-outlined btn-lg w-full"
            data-checkout-close
          >
            {{ _('Continue Shopping') }}
          </button>
        </div>
      </div>

      {# Error State #}
      <div data-checkout-error class="hidden p-8 text-center">
        <div class="mx-auto mb-4 flex size-16 items-center justify-center rounded-full bg-red-100">
          <svg class="size-8 text-red-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </div>
        <h3 class="text-foreground mb-2 text-lg font-semibold">{{ _('Something went wrong. Please try again.') }}</h3>
        <button
          type="button"
          class="btn btn-filled btn-lg mt-4 w-full"
          data-checkout-retry
        >
          {{ _('Retry') }}
        </button>
      </div>
    </div>
  </div>
</dialog>
